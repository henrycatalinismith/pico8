pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init()
 sfx_index = 1

 note_y_offsets = {}
 note_y_offsets[24] = 6  -- c2
 note_y_offsets[23] = 8  -- b1
 note_y_offsets[21] = 10 -- a1
 note_y_offsets[19] = 12 -- g1
 note_y_offsets[17] = 14 -- f1
 note_y_offsets[16] = 16 -- e1
 note_y_offsets[14] = 18 -- d1
 note_y_offsets[12] = 20 -- c1

 staff = {
  x1 = 8,
	 y1 = 32,
 	x2 = 120,
 	y2 = 48,
  c  = 14,
 }

 started = time()
 sfx(sfx_index)

 notes = {}
 for i = 0,31 do
  if i % 2 == 0 or i == 30 then
   local addr = 0x3200+68*sfx_index+2*i
   local note = peek(addr)
   local ts = i*16 * 1/128
   local tf = ts + 32* 1/128
   add(notes, {
    i = i,
    ts = ts,
    tf = tf,
    n = note,
    x = 16 + i * 3,
    y = note_y_offsets[note]-0,
    r = 2,
    bg = 7,
    fg = 0,
   })
  end
 end
 
end

function _update()
 elapsed = time() - started
 for i,note in pairs(notes) do
  note.r = 1
  note.bg = 7
  if elapsed > note.ts and elapsed < note.tf then
   note.r = 2
   note.bg = 7
  end
 end
end

function _draw()
 cls(7)
 draw_staff()
 draw_notes()
end

function draw_notes()
 for note in all(notes) do
  if note.n != 0 then
  	local x = staff.x1 + note.x
  	local y = staff.y1 + note.y
   local x1 = staff.x1
    + note.x
    - flr(note.r/2)
   local y1 = staff.y1
    + note.y
    - flr(note.r/2)
   local x2 = x1 + note.r
   local y2 = y1 + note.r
   if note.r == 2 then
    rectfill(x1, y1, x2, y2, note.bg)
    rect(x1, y1, x2, y2, note.fg)    
   else
    circfill(x, y, note.r, note.bg)
    circ(x, y, note.r, note.fg)
   end
  end
 end
end

function draw_staff()
 sspr(8, 8-3, 19, 17+7, staff.x1, staff.y1-3)
 for x = staff.x1+12, staff.x2-1 do
  sspr(9, 8, 10, 17, x, staff.y1)
 end
 sspr(119, 8, 9, 17, staff.x2, staff.y1)
end

__gfx__
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777722277777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777227277777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777227277777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777eeeee22ee22eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee77777777
77777777e77772277227777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777e77777777
77777777e77772277227777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777e77777777
77777777e77772277227777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777e77777777
77777777eeeeee2222eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee77777777
77777777e77772227777777777777707777077777777777777777777777777777777777777777777777777777777777777777777777777777777777e77777777
77777777e77722727777777777777070770707777777777777777777777777777777777777777777777777777777777777777777777777777777777e77777777
77777777e77227727777777777777707770007700077777777777777777777777777777777777777777777777777777777777777777777777777777e77777777
77777777ee22ee222eeeeeeeeeeeeeeeeeeeeee070eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee77777777
77777777e72272222227777777777777777777770777777777777777777777777777777777777777777777777777777777777777777777777777777e77777777
77777777e72272727722777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777e77777777
77777777e72277727722777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777e77777777
77777777ee22eee2ee22eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee77777777
77777777e72277727722777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777e77777777
77777777e77227727222777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777e77777777
77777777e77722222227777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777e77777777
77777777eeeeee222eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee77777777
77777777777777727777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777722727777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777722227777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777772277777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
__sfx__
011000000c0500c0000e0500e0001005010000110501100013050130001505015000170501700018050180001805018000170501700015050150001305013000110501100010050100000e0500e0000c0500c000
011000001805015000170501700015050150001305013000110501100010050100000e0500e0000c0500c0001805018000170501700015050150001305013000110501100010050100000e0500e0000c0500c000
