pico-8 cartridge // http://www.pico-8.com
version 29
__lua__

function _init()
	frame = 0
end

function _update()
	frame += 1
--	frame = (frame + 1) % limit
--	state = flr(frame / limit * 16)
end

function _draw()
 cls(0)
 
-- print(state)
-- spr(state, 64, 64, 2, 1)
 
-- spr(0, 0, 0, 2, 1)
 
-- spr(2, 16, 0, 2, 1)
-- spr(4, 32, 0, 2, 1)
-- sspr(0, 0, 16, 8, 32, 0)

	helicopter(8*0, 8*1, 0.0625*0)
	helicopter(8*2, 8*2, 0.0625*1)
	helicopter(8*4, 8*3, 0.0625*2)
	helicopter(8*6, 8*4, 0.0625*3)
	helicopter(8*7, 8*6, 0.0625*4)
	helicopter(8*7, 8*8, 0.0625*5)
end

function helicopter(cx, cy, a)
	local na = a % 1
	
	if na < 0.0625 * 1 then
	 spr(23, cx, cy, 2, 1)
	elseif na < 0.0625 * 2 then
	 spr(21, cx, cy, 2, 1)
	elseif na < 0.0625 * 3 then
	 spr(19, cx, cy, 2, 1)
	elseif na < 0.0625 * 4 then
	 spr(2, cx, cy, 1, 2)
	elseif na < 0.0625 * 5 then
	 spr(1, cx, cy, 1, 2)
	elseif na < 0.0625 * 6 then
	 spr(0, cx, cy, 1, 2)
	end
end

function old()
 local helicopter_sprite_column = ({
  hovering = 1,
  dropping = 2,
  climbing = 3,
 })[helicopter_inclination]

 local helicopter_sprite_x = (helicopter_sprite_column - 1) * 16

 local tail_y_offset = ({
  hovering = 2,
  dropping = 0,
  climbing = 3,
 })[helicopter_inclination]

 sspr(
  helicopter_sprite_x,
  0,
  16,
  8,
  helicopter_position.x - 8,
  helicopter_position.y - 4
 )

 sspr(
  helicopter_sprite_x + 3,
  8 + loop(clock_frame, 32, 8) * 3,
  13,
  3,
  helicopter_position.x - 5,
  helicopter_position.y - 5
 )

 sspr(
  helicopter_sprite_x,
  8 + loop(clock_frame, 8, 8) * 3,
  3, 3,
  helicopter_position.x - 8,
  helicopter_position.y + tail_y_offset - 4
 )
end

function draw_hitbox()
 rect(
  hitbox_box.x1,
  hitbox_box.y1,
  hitbox_box.x2,
  hitbox_box.y2,
  11
 )

 for i = 1, hitbox_box.size.x do
  pset(
   hitbox_box.position.x + i,
   hitbox_box.position.y + hitbox_box.size.y,
   11
  )

  local roof_color = 11
  local floor_color = 11
  if hitbox_box:contains(cave_roof[hitbox_box.position.x - camera_position.x + i]) then
   roof_color = 8
  end
  if hitbox_box:contains(cave_floor[hitbox_box.position.x - camera_position.x + i]) then
   floor_color = 8
  end

  line(
   hitbox_box.position.x + i,
   cave_roof[hitbox_box.position.x - camera_position.x + i].y,
   hitbox_box.position.x + i,
   cave_roof[hitbox_box.position.x - camera_position.x + i].y - 1,
   roof_color
  )

  line(
   hitbox_box.position.x + i,
   cave_floor[hitbox_box.position.x - camera_position.x + i].y,
   hitbox_box.position.x + i,
   cave_floor[hitbox_box.position.x - camera_position.x + i].y + 1,
   floor_color
  )
 end
end

function draw_overlay()
 draw_bar("cpu", stat(1), 1, 123)
 draw_bar("chk", chunk_progress, 32, 123)
 draw_bar("lvl", level_progress, 64, 123)
end

function draw_bar(l, p, x, y)
 line(x+1, y+1, x+14, y+1, 5)
 line(x+1, y+1, x+14*p, y+1, 7)
 rect(x, y, x+15, y+2, 1)
 print(l, x+17, y-1, 7)
end

function draw_smoke()
 for i, puff in pairs(smoke_puffs) do
  circ(puff.position.x, puff.position.y, puff.radius, 7)
 end
end

__gfx__
00000000000000000003000000000000000055500000005500005550000055550000000000055550000000000055555000000000000000000000000000000000
003330005333000053330000000000005555b330000055335555b330055533335555550005533355550000000333335555000000000003300000335000003350
053b000053b0000053b00000000055553333bb30055533333333bb30033333333333b33003333333335550000333333333500000000063350006335000063350
05bb00005bb000005bb000000555333333b3003003333bb3b3b3003003333bb3b3b3bb3003333bb33333355000663bb333555000000063350006333500063350
05330000053300000533000003333bb3b33000000333355333000000006635533300003000663553b3b3b33000003553b3333550000333350003333500033335
053b0000053b0000053b0000033335533300000000663333000000000000033300000000000003333000bb300000033333b3b3300535b3350035b3350035b335
0533300005333000053333000066333300000000000000500000000000000050000000000000005000000030000000500000bb300035b3350535b3350535b335
053b3000053b30000533b30000000050000000000000000000000000000000000000000000000000000000000000000000000030003333350033335000333335
53333300533333000053333003000000000000000000000000000000000000000000000000000000000000000000000000000000003b3350003b33500003b350
533b5350533b53500053b53503bb0000050000000300000005000000000000000500000000000000050000000000000033336600003333500003335000033350
533b5300053b53000053b530033b3b333330000003bb00033330000000000000333000000000000033336600000000333553333000b35500000b35000000b350
5333300005333300005333300553333b35530000033b3b3b35536600030000333553660000000033355333300000033b3bb33330003350000003350000003350
053360000053360000053360000555333bb36600055333333bb3333003bb3b3b3bb3333003003b3b3bb3333003003b33333355500bb3500000bb35000000bb50
05336000005336000005336000000533333333300005553333333330033b33333333333003bb33333333555003bb3333555500000b35000000b350000000b350
053300000053300000053300000000555533333000000055553335500055555533335550033b555533550000033b555500000000333500000333500000033300
00000000000000000000000000000000055555000000000005555000000000005555000005550000550000000555000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
60000000000000006005660000000000600566000000000060000000000066650000000000000000000000000000000000000000000000000000000000000000
06056666666666650600006666600000060000006666000000000000050000000000000000000000000000000000000000000000000000000000000000000000
00600000000000000060000000666665006566660000000000000000333366000000000000000000000000000000000000000000000000000000000000000000
06000000000000000605560000000000060000000000666600000033355333300000000000000000000000000000000000000000000000000000000000000000
06055666666666660600006666600000060000006666000003003b3b3bb333300000000000000000000000000000000000000000000000000000000000000000
06000000000000000600000000666666060556660000000003bb3333333355500000000000000000000000000000000000000000000000000000000000000000
006000000000000000656600000000000060000000006665033b5555335500000000000000000000000000000000000000000000000000000000000000000000
06056666666666650600006666600000060000006666000005550000550000000000000000000000000000000000000000000000000000000000000000000000
60000000000000006000000000666665600566660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000006660000000000000000000000665503000000050000000000000000000000000000000000000000000000000000000000000000000000
66666666666666556660006666600000666000006666000003bb0003333000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000006666550006666600000000033b3b3b355300000000000000000000000000000000000000000000000000000000000000000000
600000000000000060056600000000006000000000006665055333333bb366000000000000000000000000000000000000000000000000000000000000000000
06056666666666650600006666600000060000006666000000055533333333300000000000000000000000000000000000000000000000000000000000000000
00600000000000000060000000666665006566660000000000000055553333300000000000000000000000000000000000000000000000000000000000000000
06000000000000000605560000000000060000000000666600000000055555000000000000000000000000000000000000000000000000000000000000000000
06055666666666660600006666600000060000006666000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06000000000000000600000000666666060556660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00600000000000000065660000000000006000000000666500000000000000000000000000000000000000000000000000000000000000000000000000000000
06056666666666650600006666600000060000006666000000000000000000000000000000000000000000000000000000000000000000000000000000000000
60000000000000006000000000666665600566660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000006660000000000000000000000665500000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666556660006666600000666000006666000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000666655000666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05055000005055000005055000005050000005000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000
00999900009999000099990000999905009999050099990000999905009999000000000000000000000000000000000000000000000000000000000000000000
09aaaa9009aaaa9009aaaa9009aaaa9009aaaa9509aaaa9509aaaa9009aaaa950000000000000000000000000000000000000000000000000000000000000000
09a99a9009a99a9009a99a9009a99a9009a99a9009a99a9509a99a9509a99a900000000000000000000000000000000000000000000000000000000000000000
09a9aa9009a9aa9009a9aa9009a9aa9009a9aa9009a9aa9009a9aa9509a9aa950000000000000000000000000000000000000000000000000000000000000000
09aaaa9009aaaa9009aaaa9009aaaa9009aaaa9009aaaa9009aaaa9009aaaa950000000000000000000000000000000000000000000000000000000000000000
00999900009999000099990000999900009999000099990000999900009999000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000500000005500000005500000000000000000000000000000000000000000000000000000000000000000000
00999900009999000099990000999900509999005099990000999900509999000000000000000000000000000000000000000000000000000000000000000000
09aaaa9009aaaa9009aaaa9059aaaa9059aaaa9009aaaa9059aaaa9009aaaa900000000000000000000000000000000000000000000000000000000000000000
09a99a9009a99a9059a99a9059a99a9009a99a9059a99a9009a99a9009a99a900000000000000000000000000000000000000000000000000000000000000000
09a9aa9059a9aa9059a9aa9009a9aa9059a9aa9009a9aa9009a9aa9009a9aa900000000000000000000000000000000000000000000000000000000000000000
59aaaa9059aaaa9009aaaa9059aaaa9009aaaa9009aaaa9009aaaa9009aaaa900000000000000000000000000000000000000000000000000000000000000000
50999900009999005099990000999900009999000099990000999900009999000000000000000000000000000000000000000000000000000000000000000000
00500000050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000006060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
01200000097500e750097500e75011750117530e7500e75009753117500e75011750157501575311750117500975315750117501575018750187530c7500c75009753117500c7531175015750157501575315100
012000000c750117500c75011750157501575311750117500c75315750117501575018750187531575015750107531875015750187501c7501c75310750107500c75315750107501575019750197532170021100
01200000157551675013752167551a7501a7500000000000157551675013752167551b7501b7501570015750157550e7001a750157521a7551d7501d7501d7500000000000000000000000000000000000000000
01200000157551675013752167551a7501a7500c0000c000157551675013752167551c7501c750157001575015755157551a7551e7552175021750217502d7000000000000000000000000000000000000000000
010a00000c013006050060500605006150060517615176050c013006160061500605006150060517615176050c013006050060500605006150060500605006050c01300616006150060500615006051761517605
010a00002151300600006000060000600006001760017600095330e531095310e53311530115330e5350e5351d513027000e7001a70009700117000e7001a70009533115310e5311153315530155331153511535
01200000091540e150091500e15011150111530e1500e15009153111500e15011150151501515311150111500915315150111501515018150181530c1500c15009153111500c1531115015150151501515315100
01200002007460c746000070000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004
__music__
00 00424344
00 01424344
00 02424344
00 03424344
03 04054344

